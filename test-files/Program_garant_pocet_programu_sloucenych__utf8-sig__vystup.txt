
PØEFORMÁTOVANÝ DOTAZ (bez komentáøù):
-------------------------------------
WITH program_tmp AS
  (SELECT DISTINCT pe.* ,
                   cts.zkratka AS typ ,
                   pg.nazev AS program ,
                   pg.nazev || ' (' || cts.zkratka || ')' AS typ_program
   FROM st01.program pg
   INNER JOIN st01.c_typ_studia cts ON (cts.typ_studia_id = pg.typ_studia_id
                                        AND pg.fakulta_id = 4
                                        AND pg.rok_platnosti = 2022
                                        AND pg.akreditace_do >= to_date('2025-01-01', 'YYYY-MM-DD')
                                        AND pg.status = 9)
   INNER JOIN st01.c_forma_studia cfs ON (cfs.forma_studia_id = pg.forma_studia_id
                                          AND cfs.zkratka in ('P',
                                                              'K') )
   INNER JOIN
     (SELECT pe50.per_id ,
             pe50.label_pr AS garant
      FROM brutisadm.person pe50
      WHERE pe50.status = 9 ) pe ON pe.per_id = pg.garant_id) ,
     garant_tmp AS
  (SELECT pt.per_id,
          pt.garant ,
          count(DISTINCT pt.typ_program) AS pocet_programu ,
          listagg(DISTINCT pt.typ, ', ') within group(
                                                      ORDER BY pt.typ) AS typy_programu ,
                                                listagg(pt.typ_program, ', ') within group(
                                                                                           ORDER BY pt.typ_program) AS programy
   FROM program_tmp pt
   GROUP BY pt.per_id,
            pt.garant)
SELECT tmp.*
FROM garant_tmp tmp
ORDER BY pocet_programu,
         garant
-------------------------------------

TABULKA program_tmp (ID 0)
    Aliasy:
        pt
    Attributy:
        cts.zkratka (alias: typ)
        pe.*
        pg.nazev (alias: program)
        pg.nazev || ' (' || cts.zkratka || ')' (alias: typ_program)
    Vazba na tabulky:
        st01.program (ID 1)
        join-0 (ID 3)
        join-1 (ID 5)
        join-2 (ID 8)
    Komentáø:
        "-- as program_tmp     ---------------------- [...]"
    SQL kód:
        "program_tmp as (select distinct pe.*         [...]"

TABULKA st01.program (ID 1)
    Aliasy:
        pg
    Attributy:
        <žádné>
    Vazba na tabulky:
        <žádné>
    Komentáø:
        ""
    SQL kód:
        ""

TABULKA st01.c_typ_studia (ID 2)
    Aliasy:
        cts
    Attributy:
        <žádné>
    Vazba na tabulky:
        <žádné>
    Komentáø:
        ""
    SQL kód:
        ""

TABULKA join-0 (ID 3)
    Aliasy:
        <žádné>
    Attributy:
        cts.typ_studia_id = pg.typ_studia_id
        pg.akreditace_do >= to_date('2025-01-01', 'YYYY-MM-DD')
        pg.fakulta_id = 4
        pg.rok_platnosti = 2022
        pg.status = 9
    Vazba na tabulky:
        st01.c_typ_studia (ID 2)
    Komentáø:
        ""
    SQL kód:
        "inner join st01.c_typ_studia cts             [...]"

TABULKA st01.c_forma_studia (ID 4)
    Aliasy:
        cfs
    Attributy:
        <žádné>
    Vazba na tabulky:
        <žádné>
    Komentáø:
        ""
    SQL kód:
        ""

TABULKA join-1 (ID 5)
    Aliasy:
        <žádné>
    Attributy:
        cfs.forma_studia_id = pg.forma_studia_id
        cfs.zkratka IN ('P', 'K')
    Vazba na tabulky:
        st01.c_forma_studia (ID 4)
    Komentáø:
        ""
    SQL kód:
        "inner join st01.c_forma_studia cfs           [...]"

TABULKA select-0 (ID 6)
    Aliasy:
        pe
    Attributy:
        pe50.label_pr (alias: garant)
        pe50.per_id (alias: --, pe50.per_family_names as prijmeni, pe50.per_first_names as jmeno 
                        )
        pe50.status = 9
    Vazba na tabulky:
        brutisadm.person (ID 7)
    Komentáø:
        ""
    SQL kód:
        "select pe50.per_id --, pe50.per_family_names [...]"

TABULKA brutisadm.person (ID 7)
    Aliasy:
        pe50
    Attributy:
        <žádné>
    Vazba na tabulky:
        <žádné>
    Komentáø:
        ""
    SQL kód:
        ""

TABULKA join-2 (ID 8)
    Aliasy:
        <žádné>
    Attributy:
        pe.per_id = pg.garant_id
    Vazba na tabulky:
        select-0 (ID 6)
    Komentáø:
        ""
    SQL kód:
        "inner join (select pe50.per_id --, pe50.per_ [...]"

TABULKA garant_tmp (ID 9)
    Aliasy:
        tmp
    Attributy:
        count(distinct pt.typ_program) (alias: pocet_programu)
        listagg(distinct pt.typ,', ') (alias: within)
        pt.garant
        pt.per_id
    Vazba na tabulky:
        program_tmp (ID 0)
    Komentáø:
        "-- as garant_tmp     ----------------------- [...]"
    SQL kód:
        "select pt.per_id, pt.garant             , co [...]"

TABULKA select-1 (ID 10)
    Aliasy:
        <žádné>
    Attributy:
        tmp.*
    Vazba na tabulky:
        garant_tmp (ID 9)
    Komentáø:
        ""
    SQL kód:
        "select tmp.* from garant_tmp tmp order by po [...]"

